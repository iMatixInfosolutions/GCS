@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Customers";
}


<!-- BEGIN PAGE HEADER-->
<div class="row">
    <div class="col-md-9">
        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
        <h3 class="page-title">Customers
        </h3>
        <!-- END PAGE TITLE & BREADCRUMB-->
    </div>
    <div class="col-md-3">
        <span class="pull-right">
            <button type="button" class="btn btn-sm blue" data-bind="click: AddNew">+ &nbsp; Add New Customer</button>
            <div class="btn-group">
                <button id="btnGroupVerticalDrop1" type="button" class="btn btn-default dropdown-toggle btn-sm" data-toggle="dropdown">
                    Actions <i class="fa fa-angle-down"></i>
                </button>
                <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="btnGroupVerticalDrop1">
                    <li>
                        <a href="#"><i class="fa fa-file-excel-o" style="color: #0ec700;"></i>Export to Excel</a>
                    </li>
                </ul>
            </div>
        </span>
    </div>

</div>


<div class="row">
    <div class="col-md-12">
        <hr style="margin-top: -10px;" />



        <div id="tbl1_AdvancedSearch">
            <div>
                <label>Verified</label>
                <select id="select2_sample2" class="form-control  input-sm" data-placeholder="Select...">
                    <option value="">All</option>
                    <option value="AL">Alabama</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>

            <div>
                <label>Name</label>
                <input type="search" class="form-control input-xs " />
            </div>

            <div>
                <label>Company Name</label>
                <input type="search" class="form-control input-xs" />
            </div>


            <hr style="margin-bottom: 5px;" />
            <div style="margin-bottom: 12px;">
                <a href='#'><i class="fa fa-times" style="margin-right: 3px;"></i>Clear Search</a> &nbsp; &nbsp;&nbsp; 
                <a href='#' id="lnk_BasicSearch"><i class="fa fa-arrow-left" style="margin-right: 3px;"></i>Back to Basic Search</a>
            </div>

        </div>


    </div>
</div>
<!-- END PAGE HEADER-->



<!--BEGIN PAGE PRIMARY TABLE-->
<div class="row">
    <div class="col-sm-12">
        <table class="table table-striped table-bordered table-hover table-form" id="tbl1">
            <thead>
                <tr role="row" class="heading">
                    <th width="10%">Name</th>
                    <th width="15%">Company Name</th>
                    <th width="15%">City</th>
                    <th width="10%">State</th>
                    <th width="10%">Phone Number</th>
                    <th width="10%">Email</th>
                    <th width="10%">Is Supplier</th>
                    <th width="10%">Is Buyer</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<!--END PAGE PRIMARY TABLE-->

<!-- BEGIN PRIMARY MODAL CODE-->
<div id="Modal1" class="modal fade" id="portlet-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form id="DefaultForm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Add Customer</h4>
                </div>
                <div class="modal-body ativa-scroll">

                    <table class="tbl-form" style="">
                        <tr>
                            <td>Name</td>
                            <td style="width:250px;">
                                <input type="text" class="form-control form-filter input-sm " style="width:47%;float:left; margin-right:10px;" required placeholder="First Name" name="FirstName" data-bind="value: CustomerItem.FirstName" />
                                <input type="text" class="form-control form-filter input-sm " style="width:47%;" required placeholder="Last Name" name="LastName" data-bind="value: CustomerItem.LastName" />


                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Company Name</td>
                            <td>
                                <input type="text" required class="form-control form-filter input-sm " placeholder="Company Name" name="CompanyName"  />

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Email</td>
                            <td>
                                <input type="Email" class="form-control form-filter input-sm " placeholder="Email" name="Email"  data-bind="value: CustomerItem.Email" />

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Phone</td>
                            <td>
                                <input type="text" class="form-control input-sm" placeholder="Phone" Name="Phone" data-bind="value: CustomerItem.Phone" />

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Email</td>
                            <td>
                                <input type="text" class="form-control input-sm" placeholder="Email" name="Email" data-bind="value: CustomerItem.Phone" />

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Address</td>
                            <td>
                                <input type="text" class="form-control input-sm" placeholder="Address" name="Address" data-bind="value: CustomerItem.Phone" />

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Street</td>
                            <td>
                                <input type="text" class="form-control input-sm" placeholder="Street" name="Street" data-bind="value: CustomerItem.Phone" />

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>City</td>
                            <td>
                                <select class="form-control">
                                    <option value="Chicago">Chicago</option>
                                </select>

                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Zip Code</td>
                            <td>
                                <input type="text" class="form-control input-sm" placeholder="Zip Code" name="ZipCode" data-bind="value: CustomerItem.Phone" />

                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Is Email Verified</td>
                            <td>
                                <select class="form-control">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>

                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Is Verified as Buyer</td>
                            <td>
                                <select class="form-control">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>

                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Is Supplier</td>
                            <td>
                                <select class="form-control">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>

                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Is Bulk Supplier</td>
                            <td>
                                <select class="form-control">
                                    <option value="1">Yes</option>
                                    <option value="0">No</option>
                                </select>
                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Is Verified as Supplier</td>
                            <td>
                                <select class="form-control">
                                    <option value="1">Yes</option>
                                    <option value="0">No</option>
                                </select>

                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Verified By</td>
                            <td>
                                <select class="form-control">
                                    <option value="1">Giriraj</option>
                                    <option value="2">Tarina</option>
                                    <option value="3">Clarisa</option>
                                    <option value="4">Isha</option>
                                </select>

                            </td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>Comments</td>
                            <td>
                                <textarea class="form-control input-sm" placeholder="Comments" name="Comments"></textarea>
                                

                            </td>
                            <td></td>
                        </tr>


                    </table>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn blue" data-bind="click: Save">Save changes</button>
                    <button type="button" class="btn default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </form>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- END PRIMARY MODAL CODE-->




@section PageScript{


    <script type="text/javascript">
        $(document).ready(function () {
            //Set Link Active
            //$("a[href='/Customers']").parent().addClass('active');


            //Initialize the table
            $('#tbl1').dataTable({
                "dom": 'rf<"top">t<"bottom"pi><"clear">',
                "processing": true,
                "serverSide": true,
                "ajax": "http://localhost:53659/api/Customer/GetAllCustomers",
                "columns": [{ "data": "Name" },
							{ "data": "LastName" }
                ]

            });

            $('#tbl1_filter').append("<a style='display:inline-block;color:#777;'>&mdash; OR &mdash;</a> <a href=# style='display:inline-block;margin-left:10px;margin-top:10px;' id='lnk_AdvancedSearch'>Go To Advanced Search...</a>");


            $('#lnk_AdvancedSearch').on('click', function () {
                $('#tbl1_filter').hide();
                $('#tbl1_AdvancedSearch').show();

            });

            $('#lnk_BasicSearch').on('click', function () {
                $('#tbl1_AdvancedSearch').hide();
                $('#tbl1_filter').show();
            });



            //$('#DefaultForm').validate();
            /*
            $('#select2_sample2').select2({
                placeholder: "Select a State",
                allowClear: true
            });*/



        });
    </script>


    <script type="text/javascript">
        var model;
        var Knockout = function () {
            var CustomerModel = function (raw) {
                this.Id = ko.observable(0);
                this.FirstName = ko.observable('');
                this.LastName = ko.observable('');
                this.CompanyName = ko.observable(0);
                this.Phone = ko.observable('');
                this.Email = ko.observable('');
                this.Address1 = ko.observable('');
                this.Street = ko.observable('');
                this.CityId = ko.observable('');
                this.EmailVerified = ko.observable('');
                this.IP = ko.observable('');

                this.Apply = function (raw) {
                    raw = ko.toJS(raw)
                    this.Id(raw.Id);
                    this.FirstName(raw.FirstName);
                    this.LastName(raw.LastName);
                    this.CompanyName(raw.CompanyName);
                    this.Phone(raw.Phone);
                    this.Email(raw.Email);
                    this.Address1(raw.Address1);
                    this.Street(raw.Street);
                    this.CityId(raw.CityId);
                    this.Email(raw.Email);
                    this.IP(raw.IP);
                }
                if (raw) this.Apply(raw)
            }
            var ViewModel = function () {
                var self = this;
                this.CustomerItem = new CustomerModel();

                this.AddNew = function () {
                    self.CustomerItem.Apply({});
                    $('#Modal1').modal('show');
                }
                this.Save = function () {

                    //console.log($("#DefaultForm").validate());
                    //if (!$("#DefaultForm").valid()) return false;

                    var d = JSON.stringify(ko.toJS(self.CustomerItem), null, 2)
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json;',
                        data: d,
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",
                        url: 'http://localhost:53659/api/Customer/SaveCustomer',
                        success: function (data) {
                            var result = data;
                            if (data.Success) {
                                alert(data.Message);
                                $('#Modal1').modal("hide");

                            }
                            else {


                            }
                        }
					   , error: function (XMLHttpRequest, textStatus, errorThrown) {
					       alert(JSON.stringify(XMLHttpRequest));
					   }
                    });
                }
            }

            var load = function () {
                model = new ViewModel();
                ko.applyBindings(model)
            }


            return {
                load: load
            }
        }
        $(document).ready(function () {
            var koObject = new Knockout();
            koObject.load();
        });
    </script>


}